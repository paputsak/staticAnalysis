<!DOCTYPE html>
<html lang="en" xmlns:overflow-y="http://www.w3.org/1999/xhtml" xmlns:overflow-x="http://www.w3.org/1999/xhtml"
      xmlns:display="http://www.w3.org/1999/xhtml">

<head>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/smart_wizard.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/smart_wizard_theme_arrows.min.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/jquery.smartWizard.min.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <style> body{background-color: #eee}.form-control:focus{color: #495057;background-color: #fff;border-color: #80bdff;outline: 0;box-shadow: 0 0 0 0rem rgba(0,123,255,.25)}.btn-secondary:focus{box-shadow: 0 0 0 0rem rgba(108,117,125,.5)}.close:focus{box-shadow: 0 0 0 0rem rgba(108,117,125,.5)}.mt-200{margin-top:200px} </style>
    <link href="css/style.css" rel="stylesheet">
    <link href="css/css/all.css" rel="stylesheet">

    <title>SESAME Security</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <!--<style>#attackTree {width: 800px;height: 800px;border: 1px solid lightgray;}</style>-->
    <style>#attackTree {height: 800px; border: 1px solid lightgray;}</style>
</head>

<body>

<div class="container-fluid min-vh-100">
    <div class="row min-vh-100">
        <nav class="col-md-3 d-block">
            <div class="text-center">
                <img class="d-block mx-auto my-4" src="images/SESAME_Logo.svg" alt="">
            </div>

            <ul class="nav nav-pills flex-column mb-3 mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/home">
                        <i class="fa fa-solid fa-play" aria-hidden="true"></i> Wizard steps
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="/home">
                        <i class="fa fa-solid fa-1" aria-hidden="true"></i> System Description
                    </a>
                </li>


                <li class="nav-item">
                    <a class="nav-link" href="/home">
                        <i class="fa fa-solid fa-2" aria-hidden="true"></i> Vulnerability Scanning
                    </a>
                </li>


                <li class="nav-item">
                    <a class="nav-link" href="/home">
                        <i class="fa fa-solid fa-3" aria-hidden="true"></i> Potential Attacks Identification
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link active" href="/attackTreeVis">
                        <i class="fa fa-solid fa-4" aria-hidden="true"></i> Attack Tree Visualization
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="/home">
                        <i class="fa fa-solid fa-5" aria-hidden="true"></i> Blablabla
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link " href="/home">
                        <i class="fa fa-solid fa-6" aria-hidden="true"></i> Images
                    </a>
                </li>
            </ul>
        </nav>

        <main role="main" class="col-md-9 ml-sm-auto pt-3 px-4">

            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
                <h1 class="h2">Attack Tree Visualization</h1>
                <!--<div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="dropdownUserButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fa fa-user" aria-hidden="true"></i> admin
                        </button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownUserButton">
                            <a class="dropdown-item text-secondary" data-toggle="modal" data-target="#aboutModal">About</a>

                            <a class="dropdown-item text-secondary" href="/change_password?next=/services">Change password</a>
                            <a class="dropdown-item text-secondary" href="https://github.com/CARV-ICS-FORTH/karvdash/issues" target="_blank">Report an issue</a>
                            <a class="dropdown-item text-secondary" href="/static/docs/index.html" target="_blank">Documentation</a>
                            <a class="dropdown-item text-secondary" href="/logout">Logout</a>
                        </div>
                    </div>
                </div>-->
            </div>

            <!--<div class="modal fade" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="aboutModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="aboutModalLabel">About</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">Ã—</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            This installation is running <a class="text-secondary" href="https://github.com/CARV-ICS-FORTH/karvdash" target="_blank">Karvdash</a> version 3.0.3.
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>-->

            <div class="row">
                <div class="col-md-8">
                        <div id="attackTree"></div>
                        <h3>List of Attack Trees</h3>
                        <select id="matchedTreeList" onChange="update()" size="10">
                            <option th:each="tree, iStat : ${trees}" th:text="${tree.data}" th:value="${iStat.count}"></option>
                        </select>
                </div>
                <div class="col-md-4">
                    <div class="row">
                        <table class="table table-bordered">
                            <thead>
                            <tr class="table-success">
                                <th colspan="3">Selected Node</th>
                            </tr>
                            </thead>
                            <thead>
                            <tr class="success">
                                <th>ID</th>
                                <th>Title</th>
                                <th>Extended description</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td><div id="selection1"></div>
                                <td><div id="selection2"></div></td>
                                <td><div id="selection3"></div></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </main>

    </div>
</div>

<script th:inline="javascript">

    var network;

    // set container
    var container = document.getElementById("attackTree");

    // set data
    var nodesList = [[${nodes2}]];
    var edgesList = [[${edges2}]];

    // set data
    var nodesTree = nodesList[0];
    var edgesTree = edgesList[0];
    var nodes = new vis.DataSet(nodesTree);
    var edges = new vis.DataSet(edgesTree);
    var data = {
        nodes: nodes,
        edges: edges
    };

    //set options
    var options = {
        layout: {
            hierarchical: {
                direction: "UD",
                sortMethod: "directed",
                levelSeparation: 200
            },
        },
        edges: {
            arrows: "from"
        },
    };

    initNetwork();

    function update() {
        var select = document.getElementById("matchedTreeList");
        var option = select.options[select.selectedIndex];
        console.log(option.value);

        nodesTree = nodesList[option.value-1];
        edgesTree = edgesList[option.value-1];
        nodes = new vis.DataSet(nodesTree);
        edges = new vis.DataSet(edgesTree);
        data = {
            nodes: nodes,
            edges: edges
        };

        //network = new vis.Network(container, data, options);
        initNetwork();
    }

    function initNetwork() {
        network = new vis.Network(container, data, options);

        // show details of the selected tree node
        network.on("select", function (params) {
            var tempSelectString = JSON.stringify(nodesTree.filter(item => item.id === parseInt(params.nodes)));
            const tempSelectObject = JSON.parse(tempSelectString);

            document.getElementById("selection1").innerText = tempSelectObject[0].id;
            document.getElementById("selection2").innerText = tempSelectObject[0].title;
            document.getElementById("selection3").innerText = tempSelectObject[0].extendedDescription;
        });
    }

</script>

</body>
</html>